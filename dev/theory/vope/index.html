<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Computations for VOPE coupling · HierarchicalGaussianFiltering.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://ilabcode.github.io/HierarchicalGaussianFiltering.jl/theory/vope/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HierarchicalGaussianFiltering.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction to Hierarchical Gaussian Filtering</a></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../genmodel/">The generative model of the HGF: Volatility vs. value coupling</a></li><li><a class="tocitem" href="../node/">Belief updates in the HGF: Computations of nodes</a></li><li><a class="tocitem" href="../vape/">Computations for VAPE coupling</a></li><li class="is-active"><a class="tocitem" href>Computations for VOPE coupling</a><ul class="internal"><li><a class="tocitem" href="#Update-Step"><span>Update Step</span></a></li><li><a class="tocitem" href="#Prediction-Error-Step"><span>Prediction Error Step</span></a></li><li><a class="tocitem" href="#Prediction-Step"><span>Prediction Step</span></a></li></ul></li></ul></li><li><span class="tocitem">Using the package</span><ul><li><a class="tocitem" href="../../generated_markdowns/the_HGF_nodes/">The HGF Nodes</a></li><li><a class="tocitem" href="../../generated_markdowns/building_an_HGF/">Building an HGF</a></li><li><a class="tocitem" href="../../generated_markdowns/updating_the_HGF/">Updating the HGF</a></li><li><a class="tocitem" href="../../generated_markdowns/premade_models/">List Of Premade Agent Models</a></li><li><a class="tocitem" href="../../generated_markdowns/premade_HGF/">List Of Premade HGF&#39;s</a></li><li><a class="tocitem" href="../../generated_markdowns/fitting_hgf_models/">Fitting an HGF-agent model to data</a></li><li><a class="tocitem" href="../../generated_markdowns/utility_functions/">Utility Functions</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../generated_markdowns/classic_binary/">classic binary</a></li><li><a class="tocitem" href="../../generated_markdowns/classic_usdchf/">classic continouous</a></li></ul></li><li><a class="tocitem" href="../../generated_markdowns/all_functions/">All Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Computations for VOPE coupling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Computations for VOPE coupling</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ilabcode/HierarchicalGaussianFiltering.jl/blob/main/docs/src/theory/vope.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Computations-for-VOPE-coupling"><a class="docs-heading-anchor" href="#Computations-for-VOPE-coupling">Computations for VOPE coupling</a><a id="Computations-for-VOPE-coupling-1"></a><a class="docs-heading-anchor-permalink" href="#Computations-for-VOPE-coupling" title="Permalink"></a></h1><p>As in the case of <strong>VAPE</strong> coupling, the exact computations of the <strong>UPDATE step</strong> depend on the nature of the coupling with the child node(s), while both the <strong>PE step</strong> and the <strong>PREDICTION step</strong> depend on the coupling with the parent node(s).</p><p>To describe the computations entailed by <strong>VOPE</strong> coupling, we will introduce two changes to the notation. First of all, we will express the volatility PE, or <strong>VOPE</strong>, as a function of the previously defined value PE, or <strong>VAPE</strong>. That means from now on, we will use the character <span>$\delta_i$</span> only for <strong>VAPE</strong>s:</p><p class="math-container">\[\begin{equation}
\delta_i^{(k)} \equiv \delta_i^{(k, VAPE)} = \mu_i^{(k)} - \hat{\mu}_i^{(k)},
\end{equation}\]</p><p>and introduce a new character <span>$\Delta_i$</span> for <strong>VOPE</strong>s, which we define as</p><p class="math-container">\[\begin{equation}
  \begin{split}
    \Delta_i^{(k)} \equiv \delta_i^{(k, VOPE)} &amp;= \frac{ \frac{1}{\pi_{i}^{(k)}} + (\mu_i^{(k)} - \hat{\mu}_i^{(k)})^2 }{ \frac{1}{\pi_{i}^{(k-1)}} + \nu_{i}^{(k)} } - 1 \\
    &amp;= \hat{\pi}_i^{(k)} \left( \frac{1}{\pi_{i}^{(k)}} + (\mu_i^{(k)} - \hat{\mu}_i^{(k)})^2 \right) - 1 \\
    &amp;= \hat{\pi}_i^{(k)} \left( \frac{1}{\pi_{i}^{(k)}} + (\delta_i^{(k)})^2 \right) - 1 \\
    &amp;=  \frac{\hat{\pi}_i^{(k)}}{\pi_{i}^{(k)}} + \hat{\pi}_i^{(k)} (\delta_i^{(k)})^2 - 1. \\
  \end{split}
\end{equation}\]</p><p>Note that from the first to the second line, we have used the following definition:</p><p class="math-container">\[\begin{equation*}
\hat{\pi}_{i-1}^{(k)} = \frac{1}{ \frac{1}{\pi_{i-1}^{(k-1)}} + \nu_{i-1}^{(k)} }.
\end{equation*}\]</p><p>This ensures that a given node does not need to have access to the posterior precision from the level below: <span>$\pi_{i-1}^{(k-1)}$</span>, which facilitates implementation.</p><p>In sum, we are introducing a second prediction error unit <span>$\Delta_i$</span> which is concerned with deviations from predicted uncertainty and is informed by value prediction errors and other estimates of uncertainty. It is this prediction error - a function of the unweighted (squared) value prediction error with a new precision weight - which communicates between a level&#39;s nodes and a level&#39;s volatility parent&#39;s nodes.</p><p>Second, we will introduce another quantity, which we term the (auxiliary) expected precision</p><p class="math-container">\[\begin{equation}
\gamma_i^{(k)} = \nu_i^{(k)} \hat{\pi}_i^{(k)},
\end{equation}\]</p><p>which will be computed as part of the <strong>PREDICTION step</strong> and only serves to simplify the equations and the corresponding message passing.</p><h2 id="Update-Step"><a class="docs-heading-anchor" href="#Update-Step">Update Step</a><a id="Update-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Update-Step" title="Permalink"></a></h2><p>If Node <span>$i$</span> is the volatility parent of Node <span>$i-1$</span>, then the following update equations apply to Node <span>$i$</span>:</p><p class="math-container">\[\begin{align*}
\pi_i^{(k)} &amp;= \hat{\pi}_i^{(k)}
+ \frac{1}{2}(\kappa_{i-1} \nu_{i-1}^{(k)} \hat{\pi}_{i-1}^{(k)})^2
* (1 + (1 - \frac{1}{\pi_{i-1}^{(k-1)} \nu_{i-1}^{(k)}})
\delta_{i-1}^{(k)})\\
&amp;= \hat{\pi}_i^{(k)}
+ \frac{1}{2}(\kappa_{i-1} \nu_{i-1}^{(k)} \hat{\pi}_{i-1}^{(k)})^2
* (1 + (2 - \frac{1}{\hat{\pi}_{i-1}^{(k)} \nu_{i-1}^{(k)}})
\delta_{i-1}^{(k)})\\
\mu_i^{(k)} &amp;= \hat{\mu}_i^{(k)}
+ \frac{1}{2}\kappa_{i-1} \nu_{i-1}^{(k)}
\frac{\hat{\pi}_{i-1}^{(k)}}{\pi_{i}^{(k)}} \delta_{i-1}^{(k)},
\end{align*}\]</p><p>where we have again used the definition of the predicted precision <span>$\hat{\pi}_{i-1}^{(k)}$</span> to derive an expression for the posterior precision from the previous trial <span>$\pi_{i-1}^{(k-1)}$</span>:</p><p class="math-container">\[\begin{align*}
\hat{\pi}_{i-1}^{(k)} &amp;= \frac{1}{ \frac{1}{\pi_{i-1}^{(k-1)}} + \nu_{i-1}^{(k)} }\\
\Leftrightarrow \pi_{i-1}^{(k-1)} &amp;= \frac{1}{ \frac{1}{\hat{\pi}_{i-1}^{(k)}} - \nu_{i-1}^{(k)} }.
\end{align*}\]</p><p>With the changes from above, namely the definitions of the \textsf{VOPE} <span>$\Delta_i$</span> and the expected precision <span>$\gamma_i^{(k)}$</span>, the update equations for the precision and the mean in volatility coupling simplify to: \vspace{0.5cm}</p><p class="math-container">\[\begin{align}
\pi_i^{(k)} &amp;= \hat{\pi}_i^{(k)}
+ \frac{1}{2} (\kappa_{i,i-1} \gamma_{i-1}^{(k)})^2
+ (\kappa_{i,i-1} \gamma_{i-1}^{(k)})^2 \Delta_{i-1}^{(k)}
- \frac{1}{2} \kappa_{i,i-1}^2 \gamma_{i-1}^{(k)} \Delta_{i-1}^{(k)}\\
\mu_i^{(k)} &amp;= \hat{\mu}_i^{(k)}
+ \frac{1}{2} \frac{\kappa_{i,i-1} \gamma_{i-1}^{(k)}}{\pi_i^{(k)}} \Delta_{i-1}^{(k)}
\end{align}\]</p><p>Therefore, at the time of the update, Node <span>$i$</span> needs to have access to the following quantities:</p><ul><li>Its own predictions: <span>$\hat{\mu}_i^{(k)}$</span>, <span>$\hat{\pi}_i^{(k)}$</span></li><li>Coupling strength: <span>$\kappa_{i,i-1}$</span></li><li>From level below: <span>$\Delta_{i-1}^{(k)}$</span>, <span>$\gamma_{i-1}^{(k)}$</span></li></ul><h2 id="Prediction-Error-Step"><a class="docs-heading-anchor" href="#Prediction-Error-Step">Prediction Error Step</a><a id="Prediction-Error-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-Error-Step" title="Permalink"></a></h2><p>The exact computation of the prediction error depends, like the computation of the new prediction, on the nature of the coupling with the parent nodes. We will therefore assume in the following, that Node <span>$i$</span> is the volatility child of Node <span>$i+1$</span>. Then the following quantities have to be sent up to Node <span>$i+1$</span> (see also necessary information from level below in a volatility parent):</p><ul><li>Expected precision: <span>$\gamma_{i}^{(k)}$</span></li><li>Prediction error: <span>$\Delta_{i}^{(k)}$</span></li></ul><p>Node <span>$i$</span> has already performed the \textsf{PREDICTION step} on the previous trial, so it has already computed the predicted precision, <span>$\hat{\pi}_{i}^{(k)}$</span>, and the volatiliy estimate, <span>$\nu_i^{(k)}$</span>, and out of these the expected precision, <span>$\gamma_{i}^{(k)}$</span>, for the current trial. Hence, in the <strong>PE step</strong>, it needs to perform only the following calculations:</p><p class="math-container">\[\begin{align}
\delta_i^{(k)} &amp;= \mu_i^{(k)} - \hat{\mu}_i^{(k)}\\
\Delta_i^{(k)} &amp;= \frac{\hat{\pi}_i^{(k)}}{\pi_{i}^{(k)}} + \hat{\pi}_i^{(k)} (\delta_i^{(k)})^2 - 1.
\end{align}\]</p><h2 id="Prediction-Step"><a class="docs-heading-anchor" href="#Prediction-Step">Prediction Step</a><a id="Prediction-Step-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-Step" title="Permalink"></a></h2><p>Still assuming that Node <span>$i$</span> is the volatility child of Node <span>$i+1$</span>, the <strong>PREDICTION step</strong> consists of the following simple computations:</p><p class="math-container">\[\begin{align}
\hat{\mu}_i^{(k+1)} &amp;= \mu_i^{(k)}\\
\nu_i^{(k+1)} &amp;= \exp(\kappa_i \mu_{i+1}^{(k)} + \omega_i)\\
\hat{\pi}_i^{(k+1)} &amp;= \frac{1}{\frac{1}{\pi_i^{(k)}} + \nu_i^{(k+1)} }\\
\gamma_i^{(k+1)} &amp;= \nu_i^{(k+1)} \hat{\pi}_i^{(k+1)}
\end{align}\]</p><p>Thus, the prediction for trial <span>$k+1$</span> depends again only on receiving the posterior mean of Node <span>$i+1$</span> on trial <span>$k$</span>, and knowing the Node&#39;s own posteriors.</p><p>Note that if Node~<span>$i$</span> additionally has a <strong>VAPE</strong> parent node, the prediction of the new mean, <span>$\hat{\mu}_i^{k+1}$</span> would also depend on the posterior mean of that value parent (cf. <strong>PREDICTION step</strong> for <strong>VAPE</strong> coupling).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vape/">« Computations for VAPE coupling</a><a class="docs-footer-nextpage" href="../../generated_markdowns/the_HGF_nodes/">The HGF Nodes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 22 February 2023 13:22">Wednesday 22 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
